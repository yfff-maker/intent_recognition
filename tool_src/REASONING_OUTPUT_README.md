# ğŸ“ å¸¦æ¨ç†è¯´æ˜çš„è¾“å‡ºåŠŸèƒ½

## ğŸ“‹ åŠŸèƒ½è¯´æ˜

ç°åœ¨LLMçš„è¾“å‡ºç»“æœä¸­ä¼šåŒ…å«ä¸€ä¸ªæ–°çš„å­—æ®µï¼š**`Reasoning`ï¼ˆæ¨ç†è¯´æ˜ï¼‰**

### ç¤ºä¾‹è¾“å‡º

```
Reasoning: ç”¨æˆ·å¤šæ¬¡å¿«é€Ÿä¸ "N-Course" ç»„ä»¶äº¤äº’ï¼Œ
è¡¨æ˜å…¶æ­£åœ¨å°è¯•è¿›å…¥è¯¾ç¨‹é¡µé¢ã€‚
æ­¤å¤–ï¼Œåç»­äº‹ä»¶æ˜¾ç¤ºç”¨æˆ·æŒç»­ä¸ Courses ç›¸å…³ç»„ä»¶äº¤äº’ï¼Œ
è¿›ä¸€æ­¥æ”¯æŒå…¶"å¯¼èˆªåˆ°è¯¾ç¨‹åŒºåŸŸ"çš„æ„å›¾ã€‚
å°½ç®¡é‡å¤äº¤äº’ä¸­å¯èƒ½åŒ…å«ä¸€å®šçš„å›°æƒ‘æˆ–æ“ä½œä¸é¡ºï¼Œ
ä½†ä»æ•´ä½“è¡Œä¸ºæ¨¡å¼æ¥çœ‹ï¼Œæ›´ç¬¦åˆå¯¼èˆªæ„å›¾ã€‚
```

---

## ğŸš€ å¦‚ä½•ä½¿ç”¨

### 1ï¸âƒ£ Baselineç‰ˆæœ¬ï¼ˆç®€å•è®°å¿†åº“ï¼‰

```bash
cd tool_src
python main.py
```

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `output/intent_inference_results_with_reasoning.csv`
- `output/intent_inference_results_with_reasoning.xlsx`

---

### 2ï¸âƒ£ Banditç‰ˆæœ¬ï¼ˆå¤šè‡‚è€è™æœºè®°å¿†ç®¡ç†ï¼‰

```bash
cd tool_src
python main_bandit.py
```

**è¾“å‡ºæ–‡ä»¶**ï¼š
- `output/intent_inference_results_bandit_with_reasoning.csv`
- `output/intent_inference_results_bandit_with_reasoning.xlsx`
- `output/memory_bank_statistics_with_reasoning.xlsx`

---

## ğŸ“Š è¾“å‡ºæ–‡ä»¶æ ¼å¼

Excelæ–‡ä»¶åŒ…å«ä»¥ä¸‹åˆ—ï¼š

| åˆ—å | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| **Participant** | å‚ä¸è€…ID | P1 |
| **AnchorTimestamp** | å¼‚å¸¸ç‚¹æ—¶é—´æˆ³ | 125000 |
| **AnomalyType** | å¼‚å¸¸ç±»å‹ | repeated_action |
| **Strategy** | çª—å£ç­–ç•¥ | A/B/C |
| **Intent** | è¯†åˆ«çš„æ„å›¾ | Navigate |
| **Confidence** | ç½®ä¿¡åº¦ | 0.85 |
| **Reasoning** â­ | æ¨ç†è¯´æ˜ï¼ˆæ–°å¢ï¼‰ | ç”¨æˆ·å¤šæ¬¡å¿«é€Ÿä¸... |
| **Evidence** | å¼•ç”¨çš„è¯æ®äº‹ä»¶ | [{"event_idx": "10", "why": "..."}] |
| **Notes** | å¤‡æ³¨ | - |
| **Prompt** | å®Œæ•´çš„LLMæç¤ºè¯ | (é•¿æ–‡æœ¬) |
| **RawResponse** | LLMåŸå§‹è¾“å‡º | {"intent": "Navigate", ...} |

---

## ğŸ” Reasoningå­—æ®µçš„ä½œç”¨

### 1. **æé«˜å¯è§£é‡Šæ€§**
- æ¸…æ™°è¯´æ˜ä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ„å›¾
- ç»“åˆSTMå’ŒLTMçš„å…³é”®è¡Œä¸ºæ¨¡å¼
- ä¾¿äºäººå·¥éªŒè¯å’Œç†è§£

### 2. **è¯„ä¼°LLMæ¨ç†è´¨é‡**
- æ£€æŸ¥LLMæ˜¯å¦çœŸçš„ç†è§£äº†ä¸Šä¸‹æ–‡
- å‘ç°LLMçš„æ¨ç†é”™è¯¯æˆ–åå·®
- è¯„ä¼°STM/LTMçš„æœ‰æ•ˆæ€§

### 3. **å‘å¯¼å¸ˆæ±‡æŠ¥æ—¶çš„ææ–™**
- ç›´æ¥å±•ç¤ºLLMçš„æ¨ç†è¿‡ç¨‹
- è¯æ˜æ–¹æ³•çš„æœ‰æ•ˆæ€§
- å‘ç°æ”¹è¿›æ–¹å‘

---

## ğŸ¯ Promptå˜æ›´

åœ¨ `intent_prompting.py` ä¸­ï¼ŒLLMçš„è¾“å‡ºschemaå·²æ›´æ–°ï¼š

```python
### Output Schema (MUST be valid JSON)
Return JSON with keys:
- "intent": string (one label from the list)
- "confidence": number (0..1)
- "reasoning": string (è¯¦ç»†çš„æ¨ç†è¯´æ˜ï¼Œè§£é‡Šä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ„å›¾ï¼Œ
                      éœ€è¦ç»“åˆSTMå’ŒLTMä¸­çš„å…³é”®è¡Œä¸ºæ¨¡å¼è¿›è¡Œåˆ†æï¼Œ3-5å¥è¯)
- "evidence": list of objects
- "notes": string (optional)
```

---

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### 1. **æ–‡ä»¶å‘½åè§„åˆ™**

| ç‰ˆæœ¬ | ä¸å¸¦reasoningï¼ˆæ—§ï¼‰ | å¸¦reasoningï¼ˆæ–°ï¼‰ |
|------|-------------------|------------------|
| Baseline | `intent_inference_results.xlsx` | `intent_inference_results_with_reasoning.xlsx` |
| Bandit | `intent_inference_results_bandit.xlsx` | `intent_inference_results_bandit_with_reasoning.xlsx` |

âœ… **æ–°æ—§æ–‡ä»¶äº’ä¸å¹²æ‰°**ï¼Œå¯ä»¥å¯¹æ¯”æ•ˆæœã€‚

---

### 2. **LLM Tokenæ¶ˆè€—**

æ·»åŠ reasoningå­—æ®µåï¼ŒLLMçš„è¾“å‡ºä¼šæ›´é•¿ï¼ˆæ¯æ¬¡æ¨ç†å¢åŠ 50-100 tokensï¼‰ã€‚

**é¢„ä¼°æˆæœ¬**ï¼š
```
å•æ¬¡æ¨ç†: åŸæ¥ ~100 tokens â†’ ç°åœ¨ ~150 tokens (+50%)
å…¨æµç¨‹: åŸæ¥ ~600æ¬¡æ¨ç† = 60K tokens â†’ ç°åœ¨ = 90K tokens
```

ä»ç„¶åœ¨å¯æ¥å—èŒƒå›´å†…ã€‚

---

### 3. **Reasoningè´¨é‡**

Reasoningçš„è´¨é‡å–å†³äºï¼š
- âœ… LLMæ¨¡å‹èƒ½åŠ›ï¼ˆClaude Sonnet 4.5æ•ˆæœè¾ƒå¥½ï¼‰
- âœ… STMå’ŒLTMçš„ä¿¡æ¯è´¨é‡
- âœ… Promptè®¾è®¡

å¦‚æœreasoningè´¨é‡ä¸ç†æƒ³ï¼Œå¯ä»¥ï¼š
1. åœ¨promptä¸­æ·»åŠ æ›´å¤šç¤ºä¾‹
2. è°ƒæ•´promptæªè¾ï¼ˆä¾‹å¦‚ï¼š"è¯·ä»è¡Œä¸ºæ¨¡å¼ã€æ—¶é—´é¡ºåºã€ç”¨æˆ·ç›®æ ‡ä¸‰ä¸ªè§’åº¦åˆ†æ"ï¼‰
3. ä½¿ç”¨æ›´å¼ºçš„LLMæ¨¡å‹

---

## ğŸ“ˆ åç»­åˆ†æ

å¯ä»¥åŸºäºreasoningå­—æ®µè¿›è¡Œï¼š

### 1. **å®šæ€§åˆ†æ**
- æå–LLMçš„æ¨ç†æ¨¡å¼
- å½’çº³å¸¸è§çš„æ¨ç†é€»è¾‘
- å‘ç°LLMçš„æ€ç»´ç›²åŒº

### 2. **å®šé‡åˆ†æ**
```python
# ç»Ÿè®¡reasoningé•¿åº¦
df['reasoning_length'] = df['Reasoning'].str.len()

# æ£€æŸ¥æ˜¯å¦å¼•ç”¨äº†LTM
df['mentions_ltm'] = df['Reasoning'].str.contains('é•¿æœŸ|å†å²|æ—©æœŸ', regex=True)

# åˆ†æç­–ç•¥A/B/Cçš„reasoningå·®å¼‚
df.groupby('Strategy')['reasoning_length'].mean()
```

### 3. **äººå·¥æ ‡æ³¨**
- äººå·¥è¯„ä¼°reasoningçš„è´¨é‡ï¼ˆ1-5åˆ†ï¼‰
- æ£€æŸ¥reasoningä¸çœŸå®æ„å›¾æ˜¯å¦ä¸€è‡´
- ä½œä¸ºè®ºæ–‡ä¸­çš„case studyææ–™

---

## ğŸ¤ å‘å¯¼å¸ˆæ±‡æŠ¥æ—¶çš„ä½¿ç”¨

### å±•ç¤ºæ–¹å¼1ï¼šè¡¨æ ¼æˆªå›¾

| Strategy | Intent | Confidence | Reasoning |
|----------|--------|-----------|-----------|
| A | Navigate | 0.65 | ç”¨æˆ·ç‚¹å‡»äº†N-Courseï¼Œä½†ä¸Šä¸‹æ–‡ä¿¡æ¯æœ‰é™... |
| B | Navigate | 0.78 | ç”¨æˆ·å¤šæ¬¡å¿«é€Ÿäº¤äº’N-Courseç»„ä»¶ï¼Œè¡¨æ˜æ­£åœ¨å°è¯•... |
| C | Navigate | 0.92 | ç»“åˆæ—©æœŸè¡Œä¸ºï¼ˆæµè§ˆè¯¾ç¨‹åˆ—è¡¨ï¼‰å’Œå½“å‰å¿«é€Ÿé‡å¤äº¤äº’ï¼Œæ˜ç¡®æ˜¾ç¤ºå¯¼èˆªæ„å›¾... |

**è§£é‡Š**ï¼š
- ç­–ç•¥Cï¼ˆå¤§çª—å£ï¼‰çš„reasoningæ›´å…¨é¢
- ç­–ç•¥Aï¼ˆå°çª—å£ï¼‰çš„reasoningç¼ºä¹å†å²ä¿¡æ¯
- **è¿™è¯æ˜äº†é•¿åºåˆ—å¤„ç†çš„å¿…è¦æ€§**

---

### å±•ç¤ºæ–¹å¼2ï¼šCase Study

```
æ¡ˆä¾‹ï¼šP1åœ¨ç¬¬25åˆ†é’Ÿç‚¹å‡»"N-Course"ç»„ä»¶ï¼ˆé‡å¤3æ¬¡ï¼‰

ç­–ç•¥Cçš„æ¨ç†ï¼š
"ç”¨æˆ·åœ¨ç¬¬1-3åˆ†é’Ÿæµè§ˆäº†å¤šä¸ªè¯¾ç¨‹ï¼ˆLTM chunk P1_0ï¼‰ï¼Œ
ç¬¬15åˆ†é’Ÿå°è¯•è¿›å…¥æŸä¸ªè¯¾ç¨‹ä½†å¤±è´¥ï¼ˆLTM chunk P1_5ï¼‰ï¼Œ
ç¬¬23-25åˆ†é’Ÿå†æ¬¡å¿«é€Ÿç‚¹å‡»N-Courseç»„ä»¶ï¼ˆSTMï¼‰ï¼Œ
ä»æ•´ä½“è¡Œä¸ºæ¨¡å¼çœ‹ï¼Œè¿™æ˜¯ä¸€ä¸ªæŒç»­çš„å¯¼èˆªä»»åŠ¡ï¼Œ
é‡å¤äº¤äº’å¯èƒ½æ˜¯ç”±äºç•Œé¢å“åº”é—®é¢˜ï¼Œè€Œéå›°æƒ‘ã€‚"

âœ… è¿™ä¸ªreasoningç»“åˆäº†ï¼š
- LTM: æ—©æœŸçš„æµè§ˆè¡Œä¸ºï¼ˆç¬¬1-3åˆ†é’Ÿï¼‰
- LTM: ä¸­æœŸçš„å¤±è´¥å°è¯•ï¼ˆç¬¬15åˆ†é’Ÿï¼‰
- STM: å½“å‰çš„é‡å¤äº¤äº’ï¼ˆç¬¬23-25åˆ†é’Ÿï¼‰

â†’ å……åˆ†è¯´æ˜äº†STM+LTMæœºåˆ¶çš„ä»·å€¼ï¼
```

---

## ğŸ”§ æŠ€æœ¯ç»†èŠ‚

### ä¿®æ”¹çš„æ–‡ä»¶

1. `intent_prompting.py`: æ·»åŠ reasoningåˆ°è¾“å‡ºschema
2. `main.py`: ä¿å­˜reasoningåˆ°æ–°æ–‡ä»¶
3. `main_bandit.py`: ä¿å­˜reasoningåˆ°æ–°æ–‡ä»¶

### æ ¸å¿ƒä»£ç 

```python
# 1. Promptä¸­è¦æ±‚è¾“å‡ºreasoning
"reasoning": string (è¯¦ç»†çš„æ¨ç†è¯´æ˜ï¼Œè§£é‡Šä¸ºä»€ä¹ˆé€‰æ‹©è¿™ä¸ªæ„å›¾ï¼Œ
                    éœ€è¦ç»“åˆSTMå’ŒLTMä¸­çš„å…³é”®è¡Œä¸ºæ¨¡å¼è¿›è¡Œåˆ†æï¼Œ3-5å¥è¯)

# 2. è§£æLLMè¾“å‡º
parsed = parse_intent_output(response_text)
reasoning = parsed.get("reasoning", "")

# 3. ä¿å­˜åˆ°Excel
all_rows.append({
    "Participant": p_id,
    "Intent": parsed.get("intent"),
    "Reasoning": reasoning,  # æ–°å¢å­—æ®µ
    ...
})
```

---

éœ€è¦æˆ‘ï¼š
1. å¸®ä½ è¿è¡Œä¸€æ¬¡ï¼Œç”Ÿæˆç¤ºä¾‹æ–‡ä»¶ï¼Ÿ
2. è¿›ä¸€æ­¥è°ƒæ•´promptï¼Œä¼˜åŒ–reasoningè´¨é‡ï¼Ÿ
3. åˆ›å»ºåˆ†æreasoningçš„è„šæœ¬ï¼Ÿ
